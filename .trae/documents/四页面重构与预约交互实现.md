## 页面与路由
- 路由仅保留四页：`/`(首页)、`/reserve`(预约)、`/tasks`(定时任务)、`/settings`(设置中心)。
- 首页汇总展示：用户基本信息、Cookie/SessID/蓝牙配置状态、常用座位列表、定时任务概览。
- 管理员后台入口与功能折叠进设置中心（仅管理员可见区块）。

## 数据接口与状态
- 统一使用现有接口：`/library/user_info`、`/library/seat_info`、`/library/list`、`/library/{libId}/layout`、`/library/reserve`、`/tasks/*`、`/auth/token`、`/library/get_cookie_from_url`。
- 全局 Axios 拦截：检测`errors[0].code==40001`或响应 403，弹出状态横幅，禁用写操作按钮。
- 页面状态：
  - 首页：`userInfo.currentUser`、`config(cookie/sess_id/major/minor)`、`frequentSeats`、`tasks`。
  - 预约页：`libs`、当前选中`libId`、`layout`、`reserveInfo`（经 index 回退获取）、两个常用座位。
  - 任务页：任务列表、创建/编辑弹窗。
  - 设置页：配置与管理员区块（邀请码管理、用户管理）。

## 座位 SVG 渲染与交互
- 选择场馆：下拉框绑定`libs`，切换时加载`/library/{libId}/layout`。
- 渲染：用`layout.lib_layout`中的`seats_total/max_x/max_y/seats[]`生成 SVG 网格；每个座位按`x/y`定位。
- 颜色规则（前后端字段映射）：
  - 白色：可预约（`seat_status`或`status`为可用；否则过滤不可点击）。
  - 蓝色：我的座位（对比`reserve.seat_key`与座位`key`）。
  - 绿色：我已预约但未签到（根据`reserve.status`处于“已预约未入座”态；无则回退为蓝色）。
  - 红色：不可预约（`is_open==false`或座位`status`为占用/禁用）。
- 交互：
  - 无预约状态下点击白色座位→`POST /library/reserve?lib_id&seat_key`→成功刷新`reserveInfo`与`layout`。
  - 底部展示两个常用座位，点击即触发预约；提供“蓝牙签到”按钮（见下条）。

## 蓝牙签到按钮
- 点击触发前置只读热身：调用`/library/user_info`或轻量`index`；随后调用签到动作（若后端无直接端点，则临时创建“立即执行的签到任务”并触发一次运行）。
- 响应展示签到结果；若返回 403/40001，立即终止后续动作，并提示“会话失效或账号受限”。

## 定时任务页
- 列表展示：任务类型、Cron、状态、最近一次结果。
- 新建/编辑：`seat_today/seat_tomorrow/signin`三类；保存后立即注册或更新调度。
- 禁用策略：
  - 若最近两次连续出现 40001/403，自动建议关闭任务（或直接`is_enabled=false`，需用户确认）。

## 设置中心
- 展示并编辑：Cookie、签到授权链接（SessID）、蓝牙`major/minor`；更新后自动刷新首页状态与`deny_deadline`。
- 新增“账号限制”卡片：显示`currentUser.user_deny.deny_deadline`，无值则提示“当前无预约限制”。
- 管理员区块：邀请码管理、用户列表；与原后台功能合并。

## 错误处理与防封策略（前端）
- 全局：捕获 40001/403 即停止当前交互，提示用户并禁用相关按钮；不做重试。
- 预约页：若布局加载失败或受限，标注只读并隐藏写操作；保留场馆选择与信息展示。
- 首页：当受限时在概览模块显示“受限至时间”，引导用户刷新 Cookie 或等待解除。

## 组件与实现清单
- `pages/Home.tsx`：个人信息、状态概览、常用座位、任务概览。
- `pages/Reserve.tsx`：场馆选择、SVG座位图、常用座位快捷预约、蓝牙签到按钮。
- `pages/Tasks.tsx`：任务列表与编辑弹窗。
- `pages/Settings.tsx`：现有基础上加入账号限制与管理员区块。
- `components/SeatMap.tsx`：接收`layout`与`reserveInfo`，负责渲染与点击回调。
- `api`：保持现有接口；如需“立即签到”，新增轻量端点或复用任务系统触发一次执行。

## 路由与导航
- 顶部导航四项：首页、预约、定时任务、设置中心；管理员看到设置中心内的管理区块。

## 交付与测试
- 单页逐步实现与联调；在受限模拟下验证：
  - 颜色规则与点击禁用正确。
  - 40001/403 全局拦截能立即停止交互。
  - 更新 Cookie/SessID 后状态刷新与`deny_deadline`展示。
